{% extends 'base.html' %}
{% load static %}
{% block content %}
    
        <!-- Estilos personalizados y DataTables -->
    <link rel="stylesheet" href="{% static 'css/coloresCustom.css' %}">
    <link rel="stylesheet" href="{% static 'css/tablasCustom.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css">

    
      <!-- Encabezado -->
    <div>
        <span class="fw-bold text-dark">Gestión de Sonidos DJ</span>
        <span class="mx-2 text-dark">|</span>
        <span class="text-secondary">Listado de Sonidos</span>
    </div>

    <!-- Botón para crear -->
    <div class="text-end">
        <a href="{% url 'sonidodj_crear' %}" class="btn btn-custom-success btn-add mb-4">
            <i class="bi bi-plus-circle"></i> Agregar Colaborador
        </a>
    </div>

    
    
        <!-- Tabla de eventos -->
    <div class="custom-card  desktop-table">
        <div class="table-responsive">
            <table id="sonidosTable" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Eslogan</th>
                    <th>Whatsapp</th>
                    <th>Estado</th>
                    <th style="text-align: center;">Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for sonido in sonidos  %}
                    <tr id="sonido-{{ sonido.id }}">
                        <td class="truncate-text" title="{{ sonido.nombre }}">{{ sonido.nombre }}</td>
                    <td class="truncate-text" title="{{ sonido.eslogan }}">{{ sonido.eslogan }}</td>
                        <td>{{ sonido.whatsapp }}</td>
                        
                        <td class="text-center">
                            {% if sonido.estado %}
                                <span class="badge bg-custom-success">Activo</span>
                            {% else %}
                                <span class="badge bg-custom-danger">Inactivo</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-2">
                                <a href="{% url 'sonidodj_editar' sonido.id %}" class="btn btn-custom-info btn-sm" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                         
                                <a href="{% url 'sonidodj_eliminar' sonido.id %}" class="btn btn-custom-danger btn-sm btn-delete" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">No tienes Colaboradoes.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    
    
    
        <!-- Cards para móviles (solo visibles en móviles) -->
    <div class="mobile-cards">
        <!-- Buscador para móviles -->
        <div class="mobile-search-container">
            <input type="text" id="mobileSearch" class="mobile-search-input" placeholder="Buscar Sonidos...">
            <span class="mobile-search-icon"><i class="bi bi-search"></i></span>
        </div>
        
        <!-- Contenedor de cards -->
        <div id="mobileCardsContainer">
            {% for sonido in sonidos %}
                <div class="mobile-event-card" data-search="{{ sonido.nombre|lower }} {{ sonido.whatsapp|lower }}">
                    <div class="mobile-event-header">
                        <div>
                            <div class="mobile-event-name">{{ sonido.nombre }}</div>
                            <div class="mobile-event-type">{{ sonido.eslogan }}</div>
                        </div>
                        <div>
                            {% if sonido.estado %}
                                <span class="mobile-event-status bg-custom-success text-white">Activo</span>
                            {% else %}
                                <span class="mobile-event-status bg-custom-danger text-white">Inactivo</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="mobile-event-dates">
                        <div><i class="bi bi-telephone me-1"></i> {{ sonido.whatsapp }}</div>
                    </div>
                    <div class="mobile-event-actions">
                        <a href="{% url 'sonidodj_editar' sonido.id %}" class="btn btn-custom-info btn-sm mobile-action-btn">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                  
                        <a href="{% url 'sonidodj_eliminar' sonido.id %}" class="btn btn-custom-danger btn-sm mobile-action-btn btn-delete">
                            <i class="bi bi-trash"></i> Eliminar
                        </a>
                    </div>
                </div>
    
            {% endfor %}
        </div>
        
        <!-- Paginación para móviles -->
        <div class="mobile-pagination">
            <button id="prevPage" class="mobile-pagination-btn" disabled>
                <i class="bi bi-chevron-left"></i> Anterior
            </button>
            <span id="pageInfo" class="mobile-pagination-info">Página 1 de 1</span>
            <button id="nextPage" class="mobile-pagination-btn" disabled>
                Siguiente <i class="bi bi-chevron-right"></i>
            </button>
        </div>
    </div>
    
    
    
    
    
        <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      // Inicialización de DataTable
        $(document).ready(function () {
            $('#sonidosTable').DataTable({
                order: [],
                columnDefs: [
                    {width: "20%", targets: 0},
                    {width: "30%", targets: 1},
                    {width: "25%", targets: 2},
                    {width: "10%", targets: 3, className: "text-center"},
                    {width: "15%", targets: 4, className: "text-center"},
                ],
                language: {
                    "decimal": "",
                    "emptyTable": "No hay eventos disponibles",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ eventos",
                    "infoEmpty": "Mostrando 0 a 0 de 0 eventos",
                    "infoFiltered": "(filtrado de _MAX_ eventos totales)",
                    "lengthMenu": "Mostrar _MENU_ eventos",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "No se encontraron sonidos",
                    "paginate": {
                        "first": '<i class="bi bi-rewind-fill"></i>',
                        "last": '<i class="bi bi-fast-forward-fill"></i>',
                        "next": '<i class="bi bi-caret-right-fill"></i>',
                        "previous": '<i class="bi bi-caret-left-fill"></i>'
                    }
                },
                responsive: true
            });

            // Confirmación al eliminar
            $('.btn-delete').on('click', function (e) {
                e.preventDefault();
                const url = $(this).attr('href');

                Swal.fire({
                    title: '¿Estás seguro?',
                    text: "¡Esta acción eliminará el sonido!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: 'var(--danger-color)',
                    cancelButtonColor: 'var(--secondary-color)',
                    confirmButtonText: 'Sí, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = url;
                    }
                });
            });
            
            
            // Funcionalidad de búsqueda y paginación para móviles
            let currentPage = 1;
            const cardsPerPage = 10;
            let allCards = [];
            let filteredCards = [];
            
            // Inicializar las cards
            function initializeMobileCards() {
                allCards = Array.from(document.querySelectorAll('.mobile-event-card'));
                filteredCards = [...allCards];
                updateMobileCardsDisplay();
            }
            
            // Actualizar la visualización de las cards
            function updateMobileCardsDisplay() {
                const startIndex = (currentPage - 1) * cardsPerPage;
                const endIndex = startIndex + cardsPerPage;
                const cardsToShow = filteredCards.slice(startIndex, endIndex);
                
                // Ocultar todas las cards
                allCards.forEach(card => {
                    card.style.display = 'none';
                });
                
                // Mostrar solo las cards de la página actual
                cardsToShow.forEach(card => {
                    card.style.display = 'block';
                });
                
                // Actualizar controles de paginación
                updatePaginationControls();
            }
            
            // Actualizar controles de paginación
            function updatePaginationControls() {
                const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
                const pageInfo = document.getElementById('pageInfo');
                const prevBtn = document.getElementById('prevPage');
                const nextBtn = document.getElementById('nextPage');
                
                pageInfo.textContent = `Página ${currentPage} de ${totalPages}`;
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages || totalPages === 0;
            }
            
            // Filtrar cards según búsqueda
            function filterCards(searchTerm) {
                if (searchTerm.trim() === '') {
                    filteredCards = [...allCards];
                } else {
                    filteredCards = allCards.filter(card => {
                        const searchData = card.getAttribute('data-search');
                        return searchData.includes(searchTerm.toLowerCase());
                    });
                }
                
                // Volver a la primera página después de filtrar
                currentPage = 1;
                updateMobileCardsDisplay();
            }
            
            // Inicializar cuando el DOM esté listo
            initializeMobileCards();
            
            // Event listeners para búsqueda
            document.getElementById('mobileSearch').addEventListener('input', function(e) {
                filterCards(e.target.value);
            });
            
            // Event listeners para paginación
            document.getElementById('prevPage').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updateMobileCardsDisplay();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    updateMobileCardsDisplay();
                }
            });
            
            
            
        });
    </script>
    
    <!-- Notificaciones con Notyf -->
     <script src="https://cdn.jsdelivr.net/npm/notyf@3.10.0/notyf.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css" rel="stylesheet">

    {% if messages %}
        <script>
            const notyf = new Notyf({
                duration: 3000,
                position: {x: 'right', y: 'bottom'},
                dismissible: true,
                types: [
                    {type: 'Success'},
                    {type: 'Error'}
                ]
            });

            {% for message in messages %}
                {% if message.tags == 'success' %}
                    notyf.success("{{ message }}");
                {% elif message.tags == 'error' %}
                    notyf.error("{{ message }}");
                {% endif %}
            {% endfor %}
        </script>
    {% endif %}
    
    
    
    
    
    
    
    
    
{% endblock %}